---
title: Redis学习
---

## Redis的应用场景

+ 缓存 ： 最多的是配合Mysql作为其读的缓存
	+ 保证表的数据和Redis数据的对应关系，比如让 mysql主键作为Redis这边的key等
	+ 选择一个合适的**序列化方式**
	+ 为保证数据一致性，只在数据库查询时将对象放入缓存，如果对象发生了修改或者删除操作，直接清空缓存。在数据库新增和查询后将数据放入缓存，修改后更新缓存。删除后删除换粗    ***怎么实现？** 
+ 消息队列
 + Redis中的list是一个双向链表，所以很适用于作为消息队列来使用，消息生产者只需要将消息push进队列，消费者利用pop取出消息。并且还可以保证数据的有序性。另外Redis具有的sub/pub 功能还可以作为发布者/订阅者角色。另外由于Redis具有的快照功能，也可以避免数据的丢失。
+ 时间轴：可以将一个redis 作为共用的时间轴。例如一个服务负责接收一个微博的帖子的评论，这个服务将评论数据插入到redis指定数据的最后，另一个前端的接口服务可以从最后lrange得到这个最新的评论，用来显示，推送等操作
+ 排行榜：
+ 计数器：计算器
+ 分布式锁:

### **各个数据类型的应用场景**
 + String :  Key-Value 存储结构，最简单的，使用最多的数据结构
 + Hash：例如保存一个 具有多个属性的bean对象，集中式管理。key -> {[filed] -> value} 
 + Set： Set的实现其实就是一个Value永远为null的HashMap，实际就是通过计算hash的方式来进行快速重排。Set
 + List : 数据结构为一个双向链表，对于发送缓存队列是一个典型应用。
 + SortSet： 相对于Set集合就是保证有序，Sort Set 通过用户额外提供的一个优先级的参数来为成员排序。并且是插入有序的，即自动有序
 + Pub / Sub 的模式 ： 
 + Transaction 事务模式：
 
### Redis 事务

Redis的事务同样是通过一个Muti 命令开始任务，然后命令入队列，最后执行

+ **事务相关的命令**
 + MULTI：开始一个事务
 + WATCH：WATCH只能在客户端进入事务状态之前执行,Watch在开始命令之前执行，用于监听某个某个键是否被更改。如果被监视的这个键被更改，那么当前你的事务会被中断。这样的操作用来保证事务执行的隔离性！底层被有一个WATCH_KEYS的字典，字典的键是这个数据库被监视的键，字典的值是一个链表。链表保存了所有监视这个键的客户端
 + DISCARD ： 用于取消一个任务，清空事务队列，相当一个回滚
 + EXEC：执行事务
+ **事务的ACID保证**
 + 原子性：Redis并不能保证原子性，如果一个事务在执行过程中被中断，它是没办法自动回滚的
 + 一致性：Redis 保证命令的执行是按照命令入事务队列的顺序来执行的。
 + 隔离性：Redis 是单进程程序，并且保证在执行事务时，并且在执行事务时，不会主动中断事务，另外，Watch命令也保证了所操作数据的隔离性
 + 持久性：Redis作为一个内存数据库，就不要勉强什么持久性了
![](http://redisbook.readthedocs.io/en/latest/_images/graphviz-836c8a3dc33526a649d9ecf5b7b959d72b38cc7d.svg)

<ul>

<ol>1. 事务提供了将一种或多个命令打包，然后一次性，有序性的执行机制</ol>
<ol>2. 事务在执行过程中，不会被中断，在所有命令执行完毕之后才会结束</ol>
<ol>3. 多个事务会被房屋队列当中，然后按照先进先出的顺序执行</ol>
<ol>4. WATCH可以监控事务所操作的键，可以保证事务的隔离性</ol>
<ol>5. 只有在客户端的REDIS_DIRTY_CAS选项未被打开时，才能执行事务，否则事务直接返回失败</ol>
<ol>6. Redis 的事务保证了ACID中的一致性C，和隔离性 I，并不保证原子性A，和持久性D</ol>
</ul> 
  
## 问题
+ Redis 和Datacache的区别：DataBase 只是一个datagrid（表格），redis是一个DataBase，datagrid并不含有数据持久化的功能，而database是有的
+ Redis 中的Java驱动Jedis使用的模式是代理模式，Jedis的所有操作都最后交给client去执行了。。Jedis并不是线程安全的.**不要在多线程中使用同一个Jedis实例**redis 默认存储间隔为 300s 5分钟
+ 在Redis存储中key的字符长度对存储性能是没有影响的
+ **Redis 内存优化：**
	+ 对于多影射对象，比如一个个人信息，利用id作为key，利用一个map作为个人信息的存储作为value存储。map保存有filed的名称和value
	+ 根据业务需要选择合适的数据类型，并为不同的应用场景设置相应的紧凑存储参数。
	+ 当业务场景不需要数据持久化时，关闭所有的持久化方式可以获得最佳的性能以及最大的内存使用量。
	+ 如果需要使用持久化，根据是否可以容忍重启丢失部分数据在快照方式与语句追加方式之间选择其一
	+ 不要让你的Redis所在机器物理内存使用超过实际内存总量的3/5。
+ **Redis 怎么保证和Mysql保证数据一致性**
 + 读的数据作为缓存保存到Redis，对于写操作都是直接操作的Mysql？
 + 不要求强一致实时性的读操作，都由redis进行，要求强一致性的读操作，交给
